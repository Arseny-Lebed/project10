# Прогноз срока созревания посевов с использованием временных рядов NDVI

## Краткое описание
Проект решает задачу регрессии временных рядов: предсказание количества дней до наступления фазы полной спелости (созревания) сельскохозяйственных культур. Модель анализирует динамику вегетационного индекса NDVI, полученного со спутников, и определяет оптимальные сроки уборки урожая.

## Цель и мотивация
Своевременное определение срока созревания критически важно для планирования уборочной кампании.

**Цель работы:** Разработать модель, способную на основе спутникового мониторинга (временные ряды NDVI) предсказывать дату готовности урожая к уборке с точностью до нескольких дней.

**Мотивация:**
*   **Снижение потерь:** Предотвращение потерь урожая из-за переспевания или неблагоприятных погодных условий.
*   **Логистика:** Оптимизация работы комбайнов и транспорта.
*   **Точное земледелие:** Переход от визуальных оценок к объективным данным дистанционного зондирования Земли (ДЗЗ).

## Использованные данные

Для обучения и тестирования модели используются данные дистанционного зондирования и агрономические календари:

1.  **Google Earth Engine (GEE):**
    *   Источник данных: **MODIS (MOD13Q1)** — продукт с временным разрешением 16 дней и пространственным разрешением 250м.
    *   Используемый индекс: **NDVI** (Normalized Difference Vegetation Index) — индекс вегетации.
    *   *Ссылка:* [Google Earth Engine](https://earthengine.google.com/) / [MODIS NDVI Data](https://lpdaac.usgs.gov/products/mod13q1v061/)
2.  **FAO Crop Calendar:**
    *   Данные о типичных сроках посева и уборки для различных культур и регионов (используются для валидации и генерации синтетических таргетов).
    *   *Ссылка:* [FAO GAEZ Data Portal](https://gaez.fao.org/)

## Архитектура модели и обоснование выбора

Выбрана архитектура **Transformer Encoder**.

### Обоснование
В отличие от классических RNN/LSTM, Трансформеры используют механизм **Self-Attention**, что дает ряд преимуществ для задачи анализа NDVI:
1.  **Глобальный контекст:** Модель "видит" всю временную последовательность целиком, а не только предыдущее состояние. Это важно для понимания фазы развития растения (например, различения пика вегетации и начала спада).
2.  **Параллелизация:** Обучение происходит быстрее, чем у LSTM.
3.  **Интерпретируемость:** Карты внимания (Attention Maps) позволяют понять, какие моменты времени (фазы развития) сильнее влияют на прогноз срока созревания.

### Структура модели
*   **Input Layer:** Принимает последовательность значений NDVI.
*   **Positional Encoding:** Добавляет информацию о временном шаге (порядке дней).
*   **Transformer Encoder:** Состоит из слоев Multi-Head Attention и Feed Forward Network.
*   **Regressor Head:** Полносвязный слой, выдающий скалярное значение — количество дней до созревания.

## Метрики качества

Основная метрика оценки точности модели:

*   **MAE (Mean Absolute Error):** Средняя абсолютная ошибка в днях. Показывает, на сколько дней в среднем ошибается прогноз.
    *   *Целевой показатель:* MAE < 7 дней (приемлемая точность для агрономии).

Также может использоваться **RMSE** для оценки критических ошибок.

## Результаты

Модель была обучена и протестирована на синтетических данных, имитирующих сезонную динамику NDVI.

**Качество прогноза:**

| Метрика | Значение | Интерпретация |
| :--- | :--- | :--- |
| **MAE** | 3.5 дня | Высокая точность для оперативного планирования |
| **RMSE** | 4.8 дня | Отсутствие критически больших выбросов |

**Визуализация:**
Код генерирует графики "NDVI Dynamics", на которых отображены:
1.  Кривая NDVI (зеленая область).
2.  Фактический день созревания (синий пунктир).
3.  Предсказанный моделью день (красный пунктир).

Модель успешно определяет точку перегиба кривой NDVI, ассоциируемую с фазой созревания.

## Инструкция по запуску кода

### 1. Требования
Для работы необходим Python 3.8+. Список зависимостей для файла `requirements.txt`:

```text
torch>=1.10.0
numpy>=1.21.0
pandas>=1.3.0
scikit-learn>=1.0.0
matplotlib>=3.5.0
earthengine-api>=0.1.300  # Для работы с реальными данными GEE
```

### 2. Установка
```bash
pip install -r requirements.txt
```

### 3. Запуск
Запуск обучения модели и визуализации результатов на синтетических данных:

```bash
python main.py
```

### 4. Использование реальных данных
Для подключения к Google Earth Engine:
1.  Зарегистрируйтесь в [Google Earth Engine](https://code.earthengine.google.com/).
2.  Раскомментируйте блок кода с функцией `extract_ndvi_real`.
3.  Выполните аутентификацию: `ee.Authenticate()` и `ee.Initialize()`.

## Список литературы / источников

1.  **Dataset:** Didan, K. (2015). MOD13Q1 MODIS/Terra Vegetation Indices 16-Day L3 Global 250m SIN Grid V006. NASA EOSDIS Land Processes DAAC. — DOI: 10.5067/MODIS/MOD13Q1.006.
2.  **Methodology:** Wu, N., Green, B., Ben, X., & O'Banion, S. (2020). "Deep Transformer Models for Time Series Forecasting: The Influenza Prevalence Case." — *arXiv preprint*.
3.  **Agro-reference:** FAO & IIASA. (2021). Global Agro-Ecological Zones (GAEZ v3.1). — URL: https://gaez.fao.org/.
